{% extends 'base.html' %}

{% block title %} Harold Tienda - Productos {% endblock %}

{% block content %}
<div class="products-container">
    {% if success %}
        <!-- Header de la página -->
        <div class="page-header">
            <div class="header-content">
                <div class="title-section">
                    <h1>
                        <i class="fas fa-store"></i>
                        Catálogo de Productos
                    </h1>
                    <p class="page-subtitle">{{ consulta }}</p>
                </div>
                <div class="header-actions">
                    <a href="{% url 'fake_store_api:agregar_producto' %}" class="btn btn-primary">
                        <i class="fas fa-plus"></i>
                        Agregar Producto
                    </a>
                    <button onclick="refreshProducts()" class="btn btn-secondary">
                        <i class="fas fa-sync-alt"></i>
                        Actualizar
                    </button>
                </div>
            </div>
        </div>

        <!-- Resumen de resultados -->
        <div class="results-summary">
            <div class="summary-card">
                <div class="summary-icon">
                    <i class="fas fa-box-open"></i>
                </div>
                <div class="summary-content">
                    <h3>{{ total_mostrados }} productos encontrados</h3>
                    <div class="summary-details">
                        <div class="detail-item">
                            <i class="fas fa-tags"></i>
                            <span>{{ categorias|length }} categorías disponibles</span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-clock"></i>
                            <span>Actualizado recientemente</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de filtros -->
        <div class="filters-section">
            <div class="filters-container">
                <div class="filter-group">
                    <label for="categoryFilter">Filtrar por categoría:</label>
                    <select id="categoryFilter" onchange="filterProducts()">
                        <option value="">Todas las categorías</option>
                        {% for categoria in categorias %}
                            <option value="{{ categoria.name }}">{{ categoria.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                
                <div class="search-box">
                    <label for="searchInput">Buscar productos:</label>
                    <input type="text" id="searchInput" placeholder="Buscar por nombre..." onkeyup="searchProducts()">
                </div>
                
                <div class="filter-group">
                    <label for="sortFilter">Ordenar por:</label>
                    <select id="sortFilter" onchange="sortProducts()">
                        <option value="">Orden original</option>
                        <option value="title">Nombre A-Z</option>
                        <option value="price-low">Precio: Menor a Mayor</option>
                        <option value="price-high">Precio: Mayor a Menor</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Grid de productos -->
        <div class="products-grid" id="productsGrid">
            {% for producto in productos %}
                <div class="product-card" data-id="{{ producto.id }}" data-title="{{ producto.title }}" data-price="{{ producto.price }}" data-category="{{ producto.category.name }}">
                    
                    <div class="card-header">
                        <div class="product-id">#{{ producto.id }}</div>
                        <div class="card-actions">
                            <button class="action-btn" data-action="view" data-id="{{ producto.id }}" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="action-btn" data-action="edit" data-id="{{ producto.id }}" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn" data-action="delete" data-id="{{ producto.id }}" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>

                    <div class="card-image-container">
                        {% if producto.images and producto.images.0 %}
                            <img src="{{ producto.images.0 }}" 
                                    alt="{{ producto.title }}" 
                                    class="card-image"
                                    onclick="openImageModal('{{ producto.images.0 }}', '{{ producto.title }}')">
                        {% else %}
                            <div class="no-image">
                                <i class="fas fa-image"></i>
                                <span>Sin imagen</span>
                            </div>
                        {% endif %}
                        
                        <div class="image-overlay">
                            <button class="overlay-btn" onclick="openImageModal('{{ producto.images.0|default:'/static/images/no-image.png' }}', '{{ producto.title }}')">
                                <i class="fas fa-search-plus"></i>
                            </button>
                        </div>
                    </div>

                    <div class="card-content">
                        <div class="product-category">{{ producto.category.name|default:'Sin categoría' }}</div>
                        <h3 class="product-title">{{ producto.title }}</h3>
                        <p class="product-description">{{ producto.description|truncatewords:15 }}</p>
                        
                        <div class="product-footer">
                            <div class="price-container">
                                <span class="price">${{ producto.price }}</span>
                                <span class="price-label">USD</span>
                            </div>
                            
                            <div class="rating-container">
                                <div class="stars">
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="fas fa-star"></i>
                                    <i class="far fa-star"></i>
                                </div>
                                <span class="rating-count">(4.0)</span>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Información de paginación -->
        <div class="pagination-container">
            <div class="pagination-info">
                Mostrando {{ total_mostrados }} productos en total
            </div>
        </div>

    {% else %}
        <!-- Estado de error -->
        <div class="empty-state">
            <div class="empty-icon">
                <i class="fas fa-exclamation-triangle"></i>
            </div>
            <h2>Error al cargar productos</h2>
            <p>{{ error_message }}</p>
            <div class="empty-actions">
                <button onclick="refreshProducts()" class="btn btn-primary">
                    <i class="fas fa-sync-alt"></i>
                    Reintentar
                </button>
                <a href="{% url 'fake_store_api:agregar_producto' %}" class="btn btn-secondary">
                    <i class="fas fa-plus"></i>
                    Agregar Producto
                </a>
            </div>
        </div>
    {% endif %}
</div>

<!-- Modal para visualizar imágenes -->
<div id="imageModal" class="image-modal" onclick="closeImageModal()">
    <div class="modal-content-image" onclick="event.stopPropagation()">
        <button class="modal-close" onclick="closeImageModal()">&times;</button>
        <img id="modalImage" src="" alt="">
        <div id="imageCaption" class="image-caption"></div>
    </div>
</div>

<!-- Notifications container -->
<div id="notifications-container"></div>
{% endblock %}